## 1. Function Calling 做了什么？

回顾 AI 发展史，Function Calling 的出现无疑是个转折点。这项技术正在悄无声息地重塑我们与 AI 互动的方式，而它的重要性可能比表面看起来更加深远。

**从说到做**

传统的 AI 模型就像一个只会聊天的朋友，再聪明也只能给你建议，却帮不了什么实际的忙。

Function Calling 打破了这个局限, 它让 AI 从一个"只会说不会做"的聊天伙伴，变成了一个能够实际行动起来的助手。

想象一下，当你随口说"帮我订张下周去上海的机票"，AI 不只是回复"好的"，而是真的帮你联系航空公司预订了机票。

这种体验的差别是质的飞跃。

## 2. Function Calling 的进化之路

Function Calling 并非一蹴而就，它的发展历程其实反映了 AI 与现实世界连接能力的不断突破：

- 早期的 AI 模型就像被关在笼子里的鸟儿，只能在自己的小天地里歌唱，与外界几乎没有互动可言。GPT-1、GPT-2 时代的模型就是如此。

- 随着技术的发展，开发者们开始尝试让 AI 以其他工具相互沟通，利用正则或中间层、关键字等来匹配 AI 的输出文本，再调用外部的工具，但这些方法通常是临时拼凑的，需要大量人工干预，缺乏统一性和灵活性。

- ChatGPT 插件系统的出现是一个重要里程碑。它就像给 AI 装上了一个扩展槽，开发者可以为这个槽位开发各种"插件"。虽然这个系统更加结构化，但仍然需要开发者遵循特定的框架和规则。

![](https://files.mdnice.com/user/100995/3608d0ac-a187-4b3b-9ed2-b74705dce8b0.png)

真正的突破来自 Function Calling 的正式推出：

- 2023 年 6月，OpenAI 为 GPT 模型加入了 function calling 能力
- Anthropic 的 Claude 紧随其后推出了类似功能
- Google 的 Gemini 也不甘落后，加入了这场竞赛

值得注意的是，OpenAI 在发布不久后就将 API 中的 `function*` 相关的两个参数改名为 `tool*`。

![](https://files.mdnice.com/user/100995/5bc90204-5e8f-4b85-b9c2-7c1fe20473ba.png)

Function Calling 本身也在不断成长：

- 从最初只能一次调用一个函数
- 到后来能够同时使用多个工具
- 再到如今能够智能判断最佳工具组合和调用顺序


## 3. Function Calling 原理解析

Function Calling 的核心在于，它让 AI 能够理解可用的工具，就像人类知道自己工具箱里有什么，以及何时该用什么工具一样。

想象一下，你在教一个外国朋友使用你的厨房。你不能只说"随便用"，而是需要告诉他："这是切菜的刀，那是炒菜的锅..."。

同样地，AI 会通过**结构化的函数描述**来了解每个工具的用途和使用方法。

**函数描述的关键要素**

一个好的 function 通常包括：

- 一个直观的函数名称（比如`查询天气`而不是`执行气象数据检索`）
- 清晰的参数列表（需要提供什么信息）
- 每个参数的类型限制（是文字还是数字？有没有特定格式？）
- 形象的参数描述（解释这个参数的含义和作用）
- 明确的必选/可选标识（哪些信息是必须的，哪些是可有可无的）

**实例示范**

举个例子：

```typescript
[
  {
    type: "function",
    function: {
      name: "getWeather",
      description: "获取指定城市的天气预报",
      parameters: {
        type: "object",
        properties: {
          city: {
            type: "string",
            description: "城市名称，如'北京'、'深圳'",
          },
          date: {
            type: "string",
            description: "查询日期，格式为YYYY-MM-DD",
          },
        },
        required: ["city"],
      },
    },
  },
];
```

Function Calling 本质上就是一个翻译官，它把人类随意的表达（"明天深圳会不会下雨啊？"）翻译成计算机能理解的结构化指令（`查询天气({"城市": "深圳", "日期": "2025-xx-xx"})`）。

当面对多个可用工具时，再根据当前任务选择最合适的工具。这种选择基于对函数描述的理解、用户需求的把握，以及对各工具能力范围的认识。

## 4. Function Calling 的思考过程

**决策树：行动还是回答？**

当 AI 接收到用户请求时，它会经历一系列类似人类决策的思考过程：

AI 需要判断用户是想要一个简单回答还是期望执行某项操作：

- "平安金融大厦有多高？"只需回答
- "查一下深圳明天的天气"则明显需要去查询天气数据

面对多个工具时，AI 会评估每个工具的适用性：

- 这个工具和当前需求有多匹配？
- 它能提供足够精确和完整的结果吗？
- 在多个适用工具中，哪个更高效或更准确？

确定了工具后，AI 需要从用户输入中提取必要参数：

- 有些信息用户直接提供了，比如"查北京明天天气"中的"北京"和"明天"
- 有些信息可能需要推断，比如用户只说"明天会下雨吗？"时，可能需要猜测用户所在城市

接着需要确保所有参数都合理有效：

- 日期格式是否正确
- 数值是否在合理范围内
- 必要参数是否完整

最后基于已掌握的信息，AI 需要决定：

- 是否有足够信息立即执行
- 是否需要向用户询问更多细节
- 如何处理信息不完整的情况

当函数执行完成后，AI 还需要"消化"结果——将技术性的返回数据转化为用户易于理解的自然语言回应，就像一个好的翻译不只是逐字翻译，而是要传达原意并考虑文化背景一样。

## 5. Function Calling 的幻觉问题

**参数幻觉：新型 AI 幻觉**

尽管 Function Calling 增强了 AI 的能力，但它不仅没有完全解决 AI 幻觉问题，反而引入了新形式的幻觉：参数幻觉问题。

它可能会自作主张地提供一些看似合理但实际上不正确或不存在的参数值。这表明，即使在结构化的工具使用场景中，AI 的编造倾向依然存在，只是表现形式发生了变化。

**幻觉问题的多层次性**

这种现象也提醒我们，Function Calling 虽然能在某些场景下通过引入外部真实数据来减少幻觉，但 AI 系统的幻觉问题是多层次的：

- 理解用户意图环节可能出现误解
- 选择合适工具环节可能判断错误
- 解释返回结果环节可能添加虚构信息

因此，我们需要将 Function Calling 视为减轻而非消除 AI 幻觉的一种手段，同时继续寻求更全面的解决方案。

实际上，业界已经发展出多种应对 AI 幻觉的技术路线：

- **RAG（检索增强生成）**：通过在生成回答前先检索相关文档，让 AI 基于事实而非"想象"来回答问题，显著降低了幻觉风险，尤其适用于知识密集型应用
- **知识图谱增强**：利用结构化知识库验证生成内容的事实准确性，特别适合处理实体关系类问题
- **自我反思机制**：让 AI 重新审视自己的回答，质疑可能不准确的部分
- **多模型协作**：通过多个模型互相验证信息，类似"专家小组"审议

**技术互补与未来方向**

Function Calling 与 RAG 实际上可以形成互补：

- Function Calling 让 AI 能够使用工具获取实时或专业数据
- RAG 则在生成解释或综合信息时提供事实基础

在理想状态下，一个完善的 AI 系统可能会结合这些技术，根据不同任务特点选择最合适的幻觉减缓策略。

**实用减轻策略**

要减轻这些问题，我们可以采取以下措施：

- 提供更详细清晰的函数描述，减少 AI 的"想象空间"
- 实施严格的参数验证，拒绝不符合要求的参数
- 当 AI 犯错时提供明确反馈，就像教导学生一样
- 优化函数设计，包含实例和反例，帮助 AI 更好地理解要求

通过理解这些挑战并积极应对，我们能够更好地释放 Function Calling 的潜力，让 AI 真正成为人类得力的助手，而不只是一个会聊天的程序。

## 6. 总结

Function Calling 或许不如大模型本身那样引人瞩目，但它正是连接 AI 与现实世界的关键桥梁，将决定生成式 AI 能在多大程度上真正改变我们的工作和生活方式。通过持续完善这一技术，我们离真正实用、可靠的 AI 助手又近了一步。
